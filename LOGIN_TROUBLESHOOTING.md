# ğŸ”´ PROBLÃˆME DE CONNEXION - DÃ©pannage Rapide\n\n## ğŸ” AVANT TOUT: VÃ©rifier l'Erreur Exacte\n\n### Ã‰tape 1: Console du Navigateur (OBLIGATOIRE)\n```\n1. Appuyez sur F12\n2. Allez Ã  l'onglet \"Console\"\n3. Essayez de vous connecter\n4. Regardez les messages ROUGES (erreurs)\n5. Copier-collez le message d'erreur exacte\n```\n\n**Les erreurs couantes Ã  chercher:**\n```\nâŒ \"Missing Supabase environment variables\"\nâŒ \"Cannot read property 'auth' of undefined\"\nâŒ \"Invalid login credentials\"\nâŒ \"Network error\"\nâŒ \"PGRST...\"\nâŒ \"RLS policy violation\"\n```\n\n---\n\n## âœ… SOLUTIONS PAR ERREUR\n\n### Erreur: \"Missing Supabase environment variables\"\n\n**Cause:** Fichier `.env.local` manquant ou incomplet\n\n**Solution:**\n```\n1. CrÃ©er un fichier `.env.local` Ã  la racine du projet\n2. Ajouter:\n   VITE_SUPABASE_URL=https://your-project.supabase.co\n   VITE_SUPABASE_ANON_KEY=your-anon-key-here\n\n3. RedÃ©marrer: npm run dev (Ctrl+C puis npm run dev)\n```\n\n**OÃ¹ trouver les valeurs?**\nâ†’ Supabase Dashboard â†’ Settings â†’ API â†’ Project URL & Anon Key\n\n---\n\n### Erreur: \"Invalid login credentials\"\n\n**Cause:** Email ou mot de passe incorrect\n\n**Solutions:**\n```\n1. VÃ©rifier que vous utilisez le BON email\n   - Uppercase/lowercase important\n   - Pas d'espace avant/aprÃ¨s\n\n2. VÃ©rifier le mot de passe\n   - Sensible Ã  la casse\n   - Pas d'espace\n\n3. Si vous venez de crÃ©er un compte:\n   - VÃ©rifier la confirmation d'email (optionnel selon config)\n   - Attendre quelques secondes\n   - Essayer de vous connecter\n\n4. Si aucun compte:\n   - Cliquer \"Nouvelle entreprise? CrÃ©er un compte\"\n   - Remplir tous les champs\n   - Attendre le message \"âœ… Compte crÃ©Ã©\"\n```\n\n---\n\n### Erreur: \"Tenant trouvÃ©: null\"\n\n**Cause:** Le trigger Supabase n'a pas crÃ©Ã© les enregistrements\n\n**Solution:**\n```\n1. Attendre 5 secondes\n2. Recharger la page (Ctrl+R ou F5)\n3. Essayer de vous connecter Ã  nouveau\n\nSi toujours null:\n4. Aller Ã  Supabase Dashboard\n5. VÃ©rifier que:\n   - Trigger exists: on_auth_user_created\n   - Table tenants n'est pas vide\n   - Table users n'est pas vide\n```\n\n---\n\n### Erreur: \"Cannot read property 'auth' of undefined\"\n\n**Cause:** Supabase client n'est pas initialisÃ©\n\n**Solution:**\n```\n1. VÃ©rifier .env.local a les bonnes variables\n2. RedÃ©marrer: npm run dev\n3. VÃ©rifier src/lib/supabase.js existe\n4. VÃ©rifier que supabaseUrl et supabaseAnonKey ne sont pas vides\n```\n\n**VÃ©rifier dans la console:**\n```javascript\n// F12 â†’ Console, copiez-collez:\nimport { supabase } from './lib/supabase'\nconsole.log('Supabase:', supabase)\n// Doit afficher un objet, pas undefined\n```\n\n---\n\n### Erreur: \"Network error\" ou \"Failed to fetch\"\n\n**Cause:** ProblÃ¨me de connexion Ã  Supabase\n\n**Solutions:**\n```\n1. VÃ©rifier votre connexion internet\n2. VÃ©rifier que le URL Supabase est correct:\n   VITE_SUPABASE_URL=https://xxx.supabase.co (avec https://)\n3. VÃ©rifier que votre projet Supabase est accessible\n   â†’ Aller sur supabase.com/dashboard\n   â†’ VÃ©rifier que le projet est \"Active\"\n4. Si serveur Supabase est down:\n   â†’ status.supabase.com (vÃ©rifier status)\n```\n\n---\n\n### Erreur: \"RLS policy violation\" ou \"new row violates row-level security policy\"\n\n**Cause:** RLS bloque la crÃ©ation du user record\n\n**Solution:**\n```\nCela signifie que:\n1. Le trigger a crÃ©Ã© le tenant\n2. Mais la policy RLS empÃªche la crÃ©ation du user record\n\nFixer:\n1. Aller Ã  Supabase Dashboard â†’ Authentication â†’ RLS\n2. VÃ©rifier les policies pour la table 'users'\n3. S'assurer que \"Can insert\" et \"Can select\" sont activÃ©s\n\nOu exÃ©cuter le SQL:\nALTER TABLE public.users ENABLE ROW LEVEL SECURITY;\nCREATE POLICY \"Users - Can insert during signup\"\n  ON public.users\n  FOR INSERT\n  WITH CHECK (auth_id = auth.uid());\n```\n\n---\n\n## ğŸ› ï¸ TESTS RAPIDES\n\n### Test 1: Supabase Fonctionne?\n\n```javascript\n// F12 â†’ Console\nconst { supabase } = await import('./lib/supabase')\nconst { data, error } = await supabase.auth.getSession()\nconsole.log('Session:', data, 'Error:', error)\n```\n\n**Attendu:**\n- âœ… Si loggÃ©: `data` a un `user` object\n- âœ… Si pas loggÃ©: `data.session` est null\n- âŒ Si erreur: `error` a un message\n\n### Test 2: CrÃ©er un Compte\n\n```javascript\n// F12 â†’ Console\nconst { supabase } = await import('./lib/supabase')\nconst { data, error } = await supabase.auth.signUp({\n  email: 'test@example.com',\n  password: 'TestPass123!',\n  options: {\n    data: { company_name: 'Test Company' }\n  }\n})\nconsole.log('SignUp:', data, 'Error:', error)\n```\n\n**Attendu:**\n- âœ… `data.user` a un ID\n- âŒ `error` si email existant\n\n### Test 3: Se Connecter\n\n```javascript\n// F12 â†’ Console\nconst { supabase } = await import('./lib/supabase')\nconst { data, error } = await supabase.auth.signInWithPassword({\n  email: 'test@example.com',\n  password: 'TestPass123!'\n})\nconsole.log('SignIn:', data, 'Error:', error)\n```\n\n**Attendu:**\n- âœ… `data.user` a un ID et email\n- âŒ `error` si credentials incorrects\n\n### Test 4: RÃ©cupÃ©rer le Tenant\n\n```javascript\n// F12 â†’ Console (aprÃ¨s signIn)\nconst { supabase } = await import('./lib/supabase')\nconst { data: { session } } = await supabase.auth.getSession()\nconst { data: userData } = await supabase\n  .from('users')\n  .select('tenant_id')\n  .eq('auth_id', session.user.id)\n  .single()\nconsole.log('User:', userData, 'Tenant:', userData?.tenant_id)\n```\n\n**Attendu:**\n- âœ… `userData.tenant_id` = UUID\n- âŒ Si erreur: RLS ou user record manquant\n\n---\n\n## âš™ï¸ VÃ‰RIFICATIONS PRÃ‰ALABLES\n\n### âœ… VÃ©rifier Supabase Dashboard\n\n```\n1. Aller Ã  https://supabase.com/dashboard\n2. SÃ©lectionner votre projet\n3. VÃ©rifier que le statut est \"Active\" (vert)\n4. Aller Ã  Authentication:\n   - VÃ©rifier qu'il y a au moins 1 user\n   - Si aucun user: crÃ©er un compte\n5. Aller aux Database tables:\n   - tenants: doit avoir des rows\n   - users: doit avoir des rows\n   - campaigns/ambassadeurs/etc: doit Ãªtre vides au dÃ©part\n```\n\n### âœ… VÃ©rifier les Variables d'Environnement\n\n```bash\n# Ã€ la racine du projet, vÃ©rifier que .env.local existe\nls -la .env.local  # Linux/Mac\ndir .env.local     # Windows\n\n# Contenu doit Ãªtre:\nVITE_SUPABASE_URL=https://xxx.supabase.co\nVITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\n\n# Les valeurs ne doivent PAS Ãªtre vides\n```\n\n### âœ… VÃ©rifier que npm run dev Fonctionne\n\n```bash\n# Terminal\nnpm run dev\n\n# Attendu:\n# âœ… Local: http://localhost:5173\n# âœ… Pas d'erreur JavaScript\n\n# Si erreur:\nnpm install  # RÃ©installer les dÃ©pendances\nnpm run dev  # Relancer\n```\n\n---\n\n## ğŸ”„ PROCÃ‰DURE DE RÃ‰CUPÃ‰RATION COMPLÃˆTE\n\nSi rien ne fonctionne, faire ceci:\n\n```bash\n# 1. ArrÃªter le serveur\nCtrl+C\n\n# 2. Nettoyer les dÃ©pendances\nrm -r node_modules  # Linux/Mac\nrmdir /s node_modules  # Windows\n\n# 3. Nettoyer le cache npm\nnpm cache clean --force\n\n# 4. RÃ©installer\nnpm install\n\n# 5. VÃ©rifier .env.local\n# CrÃ©er s'il n'existe pas:\necho \"VITE_SUPABASE_URL=https://xxx.supabase.co\" > .env.local\necho \"VITE_SUPABASE_ANON_KEY=yyy\" >> .env.local\n\n# 6. Relancer\nnpm run dev\n```\n\n---\n\n## ğŸ“ SI TOUJOURS BLOQUÃ‰\n\nFournir:\n1. **Message d'erreur exacte** (depuis F12 Console)\n2. **What you're trying to do:**\n   - [ ] CrÃ©er un compte\n   - [ ] Se connecter\n   - [ ] Autre: ?\n3. **Environment:**\n   - [ ] Local (http://localhost:5173)\n   - [ ] Production (https://domain.com)\n4. **Logs console** (Ctrl+C pour copier)\n5. **Statut Supabase Dashboard:**\n   - [ ] Projet active?\n   - [ ] Tables existent?\n   - [ ] Users existent?\n\n---\n\n## ğŸš¨ URGENT: VÃ©rification Ultra-Rapide\n\n```bash\n# ExÃ©cuter:\necho \"Supabase URL: $VITE_SUPABASE_URL\"\necho \"Supabase Key: ${VITE_SUPABASE_ANON_KEY:0:20}...\"\n```\n\nSi:\n- âœ… Affiche URLs valides â†’ Configuration OK\n- âŒ Vide â†’ CrÃ©er .env.local\n\n---\n\n**DÃ©crire votre problÃ¨me exacte et les logs de F12, et je peux vous aider plus prÃ©cisÃ©ment!** ğŸ‘\n"